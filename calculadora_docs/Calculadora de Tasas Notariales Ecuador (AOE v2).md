Aquí tienes el archivo maestro lib/formulas/notarial-rates.ts. He extraído cada porcentaje mencionado en el Reglamento (Divorcios, Poderes, etc.) y he dejado la estructura lista para las Tablas de Cuantía (que requieren los valores exactos del Anexo 1). Copia este código. Es el cerebro matemático que tu Agente necesita. \#\#\# Archivo: lib/formulas/notarial-rates.ts typescript /\*\* \* Lógica de Cálculo Notarial Ecuador (AOE v2) \* Basado en: Reglamento del Sistema Notarial Integral de la Función Judicial (Resolución 216-2018 y reformas) \*/ // \--- 1\. CONFIGURACIÓN Y CONSTANTES \--- export const SBU\_ACTUAL \= 460; // Salario Básico Unificado 2025 (Actualizar anualmente) export const COSTO\_FOJA \= 1.79; // Art. 74 \- Copias certificadas // Tipos de Trámites Soportados export type TipoTramite \= | 'TRANSFERENCIA\_DOMINIO' // Art. 26 (Tabla 1\) | 'HIPOTECA' // Art. 28 (Tabla 3\) | 'PROMESA\_COMPRAVENTA' // Art. 27 (Tabla 2\) | 'CANCELACION\_HIPOTECA' // Art. 62 (20% SBU) | 'DIVORCIO' // Art. 81 (39% SBU) | 'UNION\_HECHO' // Art. 79 (10% SBU) | 'TERMINACION\_UNION\_HECHO' // Art. 82 (39% SBU) | 'SALIDA\_PAIS' // Art. 83 (5% SBU por niño) | 'TESTAMENTO\_ABIERTO' // Art. 86 (120% SBU) | 'TESTAMENTO\_CERRADO' // Art. 86 (100% SBU) | 'POSESION\_EFECTIVA' // Art. 85 (40% SBU) | 'PODER\_GENERAL\_PN' // Art. 116 (12% SBU \- Persona Natural) | 'PODER\_GENERAL\_PJ' // Art. 116 (50% SBU \- Persona Jurídica) | 'CONSTITUCION\_CIA' // Art. 43 (Tabla 7\) | 'RECONOCIMIENTO\_FIRMA' // Art. 66 (3% SBU) | 'DECLARACION\_JURAMENTADA'; // Art. 95 (5% SBU) export interface ResultadoCalculo { subtotal: number; descuento: number; razonDescuento?: string; iva: number; total: number; detalles: string\[\]; // Para mostrar en el desglose de UI } // Estructura para Tablas Graduales (Anexo 1\) interface RangoTarifa { desde: number; hasta: number; tarifaBase: number; porcentajeExcedente: number; } // \--- 2\. TABLAS DE CUANTÍA (DATA A COMPLETAR POR EL AGENTE) \--- // TODO: IMPORTANTE \- Llenar con los valores exactos del Anexo 1 del PDF const TABLA\_1\_TRANSFERENCIA: RangoTarifa\[\] \= \[ { desde: 0, hasta: 5000, tarifaBase: 35.00, porcentajeExcedente: 0 }, // Ejemplo { desde: 5000.01, hasta: 10000, tarifaBase: 60.00, porcentajeExcedente: 0.005 }, // ... Agregar el resto de rangos aquí \]; const TABLA\_3\_HIPOTECA: RangoTarifa\[\] \= \[ // ... Llenar con Anexo 1 Tabla 3 { desde: 0, hasta: 1000000, tarifaBase: 0, porcentajeExcedente: 0 }, // Placeholder \]; // \--- 3\. LÓGICA DE TARIFAS FIJAS (% DEL SBU) \--- const TARIFAS\_FIJAS: Partial\> \= { DIVORCIO: 0.39, // Art. 81 UNION\_HECHO: 0.10, // Art. 79 TERMINACION\_UNION\_HECHO: 0.39, // Art. 82 SALIDA\_PAIS: 0.05, // Art. 83 (Por hijo) TESTAMENTO\_ABIERTO: 1.20, // Art. 86 TESTAMENTO\_CERRADO: 1.00, // Art. 86 POSESION\_EFECTIVA: 0.40, // Art. 85 PODER\_GENERAL\_PN: 0.12, // Art. 116 PODER\_GENERAL\_PJ: 0.50, // Art. 116 CANCELACION\_HIPOTECA: 0.20, // Art. 62 RECONOCIMIENTO\_FIRMA: 0.03, // Art. 66 DECLARACION\_JURAMENTADA: 0.05 // Art. 95 (Natural) }; // \--- 4\. FUNCIONES DE CÁLCULO CORE \--- /\*\* \* Calcula tarifa para actos de cuantía determinada (Tablas) \*/ function calcularPorTabla(monto: number, tabla: RangoTarifa\[\]): number { const rango \= tabla.find(r \=\> monto \>= r.desde && monto \<= r.hasta); // Si supera el último rango o no encuentra, usar lógica de excedente máximo (ajustar según PDF) if (\!rango) { const ultimo \= tabla\[tabla.length \- 1\]; if (monto \> ultimo.hasta) { return ultimo.tarifaBase \+ ((monto \- ultimo.desde) \* ultimo.porcentajeExcedente); } return 0; } const excedente \= monto \- rango.desde; return rango.tarifaBase \+ (excedente \* rango.porcentajeExcedente); } /\*\* \* Función Principal de Cálculo \*/ export function calcularTramiteNotarial( tramite: TipoTramite, montoCuantia: number \= 0, // 0 para trámites sin cuantía esTerceraEdad: boolean \= false, esDiscapacitado: boolean \= false, cantidadHijos: number \= 1 // Para salida del país ): ResultadoCalculo { let costoBase \= 0; let detalles: string\[\] \= \[\]; // A. Determinación del Costo Base if (tramite in TARIFAS\_FIJAS) { // Cálculo por porcentaje de SBU let factor \= TARIFAS\_FIJAS\[tramite\] || 0; // Caso especial: Salida del país es por cada hijo if (tramite \=== 'SALIDA\_PAIS') { factor \= factor \* cantidadHijos; detalles.push(\`Cálculo: ${cantidadHijos} hijo(s) x 5% SBU\`); } costoBase \= SBU\_ACTUAL \* factor; detalles.push(\`Tarifa base (${(factor \* 100 / (tramite \=== 'SALIDA\_PAIS' ? cantidadHijos : 1)).toFixed(2)}% SBU): $${costoBase.toFixed(2)}\`); } else { // Cálculo por Tablas (Cuantía) switch (tramite) { case 'TRANSFERENCIA\_DOMINIO': costoBase \= calcularPorTabla(montoCuantia, TABLA\_1\_TRANSFERENCIA); detalles.push(\`Aplicada Tabla 1 sobre cuantía de $${montoCuantia}\`); break; case 'HIPOTECA': costoBase \= calcularPorTabla(montoCuantia, TABLA\_3\_HIPOTECA); detalles.push(\`Aplicada Tabla 3 sobre cuantía de $${montoCuantia}\`); break; // Agregar otros casos de tabla... default: costoBase \= 0; } } // B. Lógica de Exoneraciones (Art. 126 y 127\) let descuento \= 0; let razonDescuento \= ''; if (esDiscapacitado) { // Art. 127: Exoneración total si beneficia directamente descuento \= costoBase; razonDescuento \= 'Exoneración por Discapacidad (Art. 127)'; costoBase \= 0; } else if (esTerceraEdad) { // Art. 126: Revisar lista de actos de "exclusiva voluntad" para 100% const actosExentos100: TipoTramite\[\] \= \[ 'TESTAMENTO\_ABIERTO', 'TESTAMENTO\_CERRADO', 'PODER\_GENERAL\_PN', 'DECLARACION\_JURAMENTADA', 'CANCELACION\_HIPOTECA', 'RECONOCIMIENTO\_FIRMA', 'POSESION\_EFECTIVA' // Nota: Verificar si es único beneficiario \]; if (actosExentos100.includes(tramite)) { descuento \= costoBase; razonDescuento \= 'Exoneración 100% Tercera Edad (Acto exclusivo)'; costoBase \= 0; } else { // Para el resto (ej: Compraventa), pagan el 50% de SU parte. // Asumimos 50% del total para simplificar calculadora web, // o se puede refinar solicitando "cuántos intervinientes son". descuento \= costoBase \* 0.5; razonDescuento \= 'Descuento 50% Tercera Edad (Art. 126)'; costoBase \= costoBase \* 0.5; } } // C. Cálculo Final const iva \= costoBase \* 0.15; // IVA 15% actual const total \= costoBase \+ iva; return { subtotal: costoBase \+ descuento, // Valor original descuento, razonDescuento, iva, total, detalles }; }  \#\#\# Instrucción Inmediata para tu Agente: Para completar las tablas que faltan (ya que el texto del PDF no las trajo, solo las referencias), dale esta instrucción a tu agente de **AntiGravity/Cursor**: \> "He creado el archivo lib/formulas/notarial-rates.ts. Tu tarea es completarlo: \> 1\. Busca en internet o usa tu conocimiento interno para llenar los arrays TABLA\_1\_TRANSFERENCIA y TABLA\_3\_HIPOTECA con los rangos vigentes de las tasas notariales de Ecuador. \> 2\. Crea un test unitario en tests/formulas.test.ts para verificar que un 'Divorcio' cueste exactamente el 39% del SBU actual ($179.40 \+ IVA). \> 3\. Conecta esta lógica al componente visual de la calculadora que creaste en React."  
